# ОТЧЕТ
## По лабораторной работе №2
**Тема:** Основы обработки цифровых изображений / сжатие изображений

**Вариант:**
*   **Столбец (Поэлементные операции):** Линейное контрастирование.
*   **Строка (Пороговая обработка):** Глобальная пороговая обработка (Ручной метод + Метод Оцу).
*   **Сжатие:** Алгоритм кодирования длины серии (RLE).

### 1. Цель работы
Изучить и реализовать на практике методы предварительной обработки цифровых изображений и алгоритмы сжатия данных. Разработать веб-приложение для демонстрации работы алгоритмов

### 2. Задание
1.  Реализовать веб-сервер и клиентский интерфейс.
2.  Реализовать алгоритм линейного контрастирования.
3.  Реализовать методы глобальной пороговой обработки:
    *   Ручной выбор порога
    *   Автоматический выбор порога
4.  Реализовать алгоритм сжатия без потерь RLE.
5.  Провести тестирование на базе изображений (зашумленные, малоконтрастные, простые геометрические фигуры)

### 3. Теоретические сведения

**3.1. Линейное контрастирование**
Метод улучшения качества изображения путем растяжения диапазона яркости на весь доступный спектр (0..255).
Формула преобразования для каждого канала:
$$ P_{new} = (P_{old} - P_{min}) \cdot \frac{255}{P_{max} - P_{min}} $$
Где $P_{min}$ и $P_{max}$ — минимальное и максимальное значения яркости, найденные на исходном изображении.

**3.2. Пороговая обработка (Бинаризация)**
Преобразование полутонового изображения в черно-белое по правилу:
*   Если яркость пикселя > $T$ (порог), то пиксель становится белым (255).
*   Иначе — черным (0).

**Метод Оцу** — алгоритм автоматического поиска порога $T$, который минимизирует дисперсию яркости внутри классов (черного и белого) или, что эквивалентно, максимизирует межклассовую дисперсию.

**3.3. Алгоритм RLE (Run-Length Encoding)**
Один из старейших и самых простых алгоритмов архивации графики. Суть сжатия состоит в замене цепочки повторяющихся байтов на пару: `[счетчик повторов, значение]`.
*   Пример: `AAAAA` (5 байт) -> `5A` (2 байта).
*   Эффективность: Высокая на изображениях с большими однотонными областями (чертежи, схемы). Низкая (или отрицательная) на фотографиях и шуме.

### 4. Описание реализации

Приложение разработано на языке **Go**.
*   **Frontend:** HTML + JavaScript
*   **Backend:** `net/http` сервер. Обработка изображений ведется через стандартную библиотеку `image`.

**Ключевые фрагменты кода:**

*Реализация метода Оцу:*
```go
func calculateOtsuThreshold(img *image.Gray) uint8 {
    // Построение гистограммы
    hist := make([]int, 256)
    for _, p := range img.Pix { hist[p]++ }

    // Перебор всех возможных порогов t для поиска максимума дисперсии
    var maxVariance float64
    var threshold int
    // ... логика вычисления весов и средних значений ...
    return uint8(threshold)
}
```

Реализация RLE:
```go
func calculateRLEStats(img *image.Gray) (origSize, compSize int, ratio float64) {
    pixels := img.Pix
    origSize = len(pixels)
    
    for i := 0; i < len(pixels); i++ {
        count := 1
        // Пока следующий пиксель совпадает с текущим
        for i+1 < len(pixels) && pixels[i] == pixels[i+1] && count < 255 {
            i++; count++
        }
        compSize += 2 // Записываем [значение, счетчик]
    }
    ratio = float64(origSize) / float64(compSize)
    return
}
```

### 5. Результаты тестирования

Для тестирования была подобрана база изображений, включающая малоконтрастные фото, сканы текста, геометрические примитивы и фото с шумом.

#### 5.1. Тестирование поэлементных операций

**А) Линейное контрастирование**
*   *Изображение:* Выцветшее фото (диапазон яркостей сжат, $min \approx 50, max \approx 200$).
*   *Результат:* Изображение стало более насыщенным, появился глубокий черный и яркий белый цвета.

**Б) Ограничения метода (Пример с лампой)**
*   *Изображение:* Темная комната с яркой лампой.
*   *Наблюдение:* Линейное контрастирование не дало видимого эффекта.
*   *Причина:* На изображении уже присутствовали пиксели с яркостью 0 и 255 (полный динамический диапазон), поэтому формула растяжения выродилась в тождественное преобразование.

*[Здесь вставьте скриншоты: Туман (До/После), Лампа (Гамма-коррекция)]*

#### 5.2. Тестирование пороговой обработки

**Метод Оцу**
*   *Изображение:* Четкий скан текста.
*   *Результат:* Идеальное разделение текста и фона. Порог подобран автоматически.

#### 5.3. Тестирование сжатия (RLE)

| Тип изображения | Исходный размер (байт) | Сжатый размер (байт) | Коэффициент | Вывод |
| --- | --- | --- | --- | --- |
| **Геометрические фигуры** | 921600 | 16412 | **56** | Высокое сжатие |
| **Фотография (шум)** | 280908 | 516664 | **0.54** | Файл увеличился |

*   **Наилучший случай:** Изображения с большими областями одного цвета сжимаются в десятки раз.
*   **Наихудший случай:** Фотографии и зашумленные изображения. Так как соседние пиксели редко совпадают, алгоритм записывает пару байт на каждый пиксель, увеличивая объем данных почти в 2 раза.

### 6. Вывод
В ходе лабораторной работы было реализовано веб-приложение для обработки изображений.

1.  Установлено, что **линейное контрастирование** эффективно только для изображений с неполным использованием динамического диапазона (выцветшие фото).
2.  Сравнение методов бинаризации показало, что **метод Оцу** отлично работает на изображениях с бимодальной гистограммой (четкий объект и фон), но может давать сбои при неравномерном освещении, где требуется ручная подстройка.
3.  Анализ алгоритма **RLE** подтвердил его эффективность только для определенного класса изображений (схемы, графика). Для сжатия фотографий данный алгоритм непригоден, так как приводит к увеличению размера файла ("отрицательное сжатие").